<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.1" />
<title>msiempy API documentation</title>
<meta name="description" content="Welcome to the **msiempy** library documentation.
The pythonic way to deal with McAfee SIEM API.
Head out to one of the sub-modules to see objects â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/foundation.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<link rel="canonical" href="https://pdoc3.github.io/pdoc/doc/msiempy/">
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<link rel="icon" href="https://avatars0.githubusercontent.com/u/50667087?s=200&v=4">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>msiempy</code></h1>
</header>
<section id="section-intro">
<p>Welcome to the <strong>msiempy</strong> library documentation.<br>
The pythonic way to deal with McAfee SIEM API.<br>
Head out to one of the sub-modules to see objects definitions or scroll down for general documentation.<br>
Checkout the <a href="https://github.com/mfesiem/msiem">msiem CLI</a> if you're looking for a CLI tool.
</p>
<hr>
<p>Links : <a href="https://github.com/mfesiem/msiempy">GitHub</a>, <a href="https://pypi.org/project/msiempy/">PyPI</a>, <a href="https://mfesiem.github.io/docs/msiempy/classes.png">Class diagram</a>, <a href="https://mfesiem.github.io/docs/msiempy/packages.png">Packages diagram</a>, <a href="https://mfesiem.github.io">SIEM API references Home</a> (generated PDFs and other links)
</p>
<hr>
<h2 id="installation">Installation</h2>
<pre><code>python3 -m pip install msiempy
</code></pre>
<h2 id="authentication-and-configuration-setup">Authentication and configuration setup</h2>
<p>The module offers a single point of authentication against your SIEM, so you don't have to worry about authentication when writting your scripts. This means that you need to preconfigure the authentication using the configuration file.</p>
<p>The configuration file is located (by default) securely in your user directory since it contains credentials.<br>
- For Windows:
<code>%APPDATA%\.msiem\conf.ini</code><br>
- For Mac :
<code>$HOME/.msiem/conf.ini</code><br>
- For Linux :
<code>$XDG_CONFIG_HOME/.msiem/conf.ini</code> or :
<code>$HOME/.msiem/conf.ini</code>
</p>
<pre><code>[esm]
host = HOST
user = USER
passwd = PASSWORD's BASE64

[general]
verbose = no
quiet = no
logfile = /var/log/msiempy/log.txt
timeout = 60
ssl_verify = no
</code></pre>
<p>To set the password, you can use the <a href="https://github.com/mfesiem/msiempy/blob/master/samples/msiempy_setup.py"><code>msiempy_setup.py</code></a> script.<br>
You can also directly paste the password's base64 in the config file by doing:
</p>
<pre><code class="python">&gt;&gt;&gt; import base64
&gt;&gt;&gt; passwd = 'P@assW0rd'
&gt;&gt;&gt; print(base64.b64encode(passwd.encode('utf-8')).decode())
UEBhc3NXMHJk
</code></pre>
<h2 id="examples">Examples</h2>
<h3 id="acknowledge-alarms">Acknowledge alarms</h3>
<p>See objects: <code><a title="msiempy.alarm.AlarmManager" href="alarm.html#msiempy.alarm.AlarmManager">AlarmManager</a></code> and <code><a title="msiempy.alarm.Alarm" href="alarm.html#msiempy.alarm.Alarm">Alarm</a></code></p>
<p>Print all <code>unacknowledged</code> alarms of the year who's name <em>match</em> <code>'Test alarm'</code> and triggering event message match <code>'Wordpress'</code>.
Then acknowledge the alarms and make sure they are all acknowledged.
</p>
<p>The number of alarms retreived is defined by the <code>page_size</code> property.</p>
<pre><code class="python">from msiempy import AlarmManager, Alarm
# Make an alarm query
alarms=AlarmManager(
        time_range='CURRENT_YEAR',
        status_filter='unacknowledged', # This filter is computed on the server side
        filters=[('alarmName', 'Test alarm')], # Other filters are applied as regex
        event_filters=[('ruleName','Wordpress')], 
        page_size=5 # Will only load 5 alarms (per query), increase limit to 500 or 1000 for better performance
    ) 
# Load the data into the list
alarms.load_data() 
# Print results
print(&quot;Alarm list: &quot;)
print(alarms)
print(alarms.get_text(
        fields=['id','triggeredDate','acknowledgedDate', 'alarmName', 'acknowledgedUsername']))
# Acknowledge alarms
print(&quot;Acknowledge alarms...&quot;)
for alarm in alarms:
    alarm.acknowledge()
</code></pre>
<h3 id="execute-an-event-query">Execute an event query</h3>
<p>See objects: <code><a title="msiempy.event.EventManager" href="event.html#msiempy.event.EventManager">EventManager</a></code>, <code><a title="msiempy.event.FieldFilter" href="event.html#msiempy.event.FieldFilter">FieldFilter</a></code>, <code><a title="msiempy.event.Event" href="event.html#msiempy.event.Event">Event</a></code><br>
Query events according to destination IP and hostname filters, sorted by AlertID. </p>
<pre><code class="python">from  msiempy import EventManager, FieldFilter

print('Simple event query sorted by AlertID')
events = EventManager(
        time_range='CURRENT_YEAR',
        fields=['SrcIP', 'AlertID'], # SrcIP and AlertID are not queried by default
        filters=[
                FieldFilter('DstIP', ['0.0.0.0/0',]),
                FieldFilter('HostID', ['mail'], operator='CONTAINS')], # Please replace &quot;mail&quot; by a test hostname
        order=(('ASCENDING', 'AlertID')),
        limit=10) # Will only load 10 events (per query), increase limit to 500 or 1000 once finish testing for better performance

events.load_data()
print(events)
print(events.get_text(fields=['AlertID','LastTime','SrcIP', 'Rule.msg']))
</code></pre>
<h3 id="add-a-note-to-events">Add a note to events</h3>
<p>Setting the note of an event, retreiving the genuine event from IPSIDAlertID and checking the note is well set. See <a href="https://github.com/mfesiem/msiempy/blob/master/samples/add_wpsan_note.py"><code>add_wpsan_note.py</code></a> script to see more how to add note to event that triggered alarms !
</p>
<pre><code class="python">from  msiempy import EventManager, Event
events = EventManager(
        time_range='CURRENT_YEAR',
        limit=2
)
events.load_data()

for event in events :
        event.set_note(&quot;Test note&quot;)
        genuine_event = Event(id=event['IPSIDAlertID']) # Event data will be loaded with ipsGetAlertData
        assert &quot;Test note&quot; in genuine_event['note'], &quot;The note doesn't seem to have been added to the event 
 {}&quot;.format(event)
</code></pre>
<p><code><a title="msiempy.event.EventManager" href="event.html#msiempy.event.EventManager">EventManager</a></code> have other arguments: <code>order</code>, <code>start_time</code> and <code>end_time</code> or <code>time_rage</code>
</p>
<p><code><a title="msiempy.event.EventManager.load_data" href="event.html#msiempy.event.EventManager.load_data">EventManager.load_data()</a></code> method accept also several parameters. It controls the query's division time range into slots of <code>delta</code> duration, then the query would be divided into the specified number of <code>slots</code>. Control also the number of asyncronous jobs using <code>workers</code> parameter. <code>max_query_depth</code> parameter specify the number of sub-divisions the query can take at most (zero by default). The query is divided only if it hasn't completed with the current query settings. <br>
See method documentation for more infos.
</p>
<p>See <a href="https://github.com/mfesiem/msiempy/blob/master/samples/dump_all_fields.py"><code>dump_all_fields.py</code></a> script to have full list of <code>fields</code> you can request and fields you can use with <code>FieldFilter</code> .</p>
<h3 id="execute-a-grouped-event-query">Execute a grouped event query</h3>
<p>Query the curent day events filtered by <code>IPSID</code> grouped by <code>ScrIP</code>.
</p>
<p>See objects: <code><a title="msiempy.event.GroupedEventManager" href="event.html#msiempy.event.GroupedEventManager">GroupedEventManager</a></code> and <code><a title="msiempy.event.GroupedEvent" href="event.html#msiempy.event.GroupedEvent">GroupedEvent</a></code>.
</p>
<pre><code class="python">from msiempy import GroupedEventManager
import pandas
query = GroupedEventManager(
    time_range='LAST_3_DAYS', 
    field='SrcIP', 
    filters=[('IPSID', '144116287587483648')]) 
query.load_data()
# Sort the results by total count
results = list(reversed(sorted(query, key=lambda k: int(k['SUM(Alert.EventCount)']))))
# Display top 10 in a panda frame
frame=pandas.DataFrame(results[:10])
print(frame.to_string(index=False))
</code></pre>
<p>Tip: <a href="https://github.com/mfesiem/msiempy/blob/master/samples/all_dev.py"><code>all_dev.py</code> script</a> can help you list all your datasources IDs (for the required <code>IPSID</code> filter).
</p>
<h3 id="print-esm-infos">Print ESM infos</h3>
<p>See object: <code><a title="msiempy.device.ESM" href="device.html#msiempy.device.ESM">ESM</a></code></p>
<p>Print a few esm infos. ESM object has not state for it self, it's a simple interface to data structures / values returned by the SIEM.
</p>
<pre><code class="python">&gt;&gt;&gt; from msiempy import ESM
&gt;&gt;&gt; esm=ESM()
&gt;&gt;&gt; esm.version()
'11.2.1'
&gt;&gt;&gt; esm.recs()
[('ERC-1', 144116287587483648)]
&gt;&gt;&gt; esm.buildstamp()
'11.2.1 20190725050014'
</code></pre>
<h3 id="dump-datasources">Dump Datasources</h3>
<p>See objects: <code><a title="msiempy.device.DevTree" href="device.html#msiempy.device.DevTree">DevTree</a></code>, <code><a title="msiempy.device.DataSource" href="device.html#msiempy.device.DataSource">DataSource</a></code></p>
<p>Load all datasources and write all infos in a CSV file.
</p>
<pre><code class="python">from msiempy import DevTree

devtree = DevTree()

with open('all-datasources.csv', 'w') as f:
        f.write(devtree.get_text(format='csv'))
</code></pre>
<h3 id="dump-watchlists-definitions">Dump Watchlists definitions</h3>
<p>See objects: <code><a title="msiempy.watchlist.WatchlistManager" href="watchlist.html#msiempy.watchlist.WatchlistManager">WatchlistManager</a></code>, <code><a title="msiempy.watchlist.Watchlist" href="watchlist.html#msiempy.watchlist.Watchlist">Watchlist</a></code></p>
<p>Print whatchlist list.</p>
<pre><code class="python">from msiempy import WatchlistManager
watchlists=WatchlistManager()
print(watchlists)
</code></pre>
<h3 id="use-the-session-object">Use the Session object</h3>
<p>See object: <code><a title="msiempy.core.session.NitroSession" href="core/session.html#msiempy.core.session.NitroSession">NitroSession</a></code>
</p>
<p>You can choose not to use wrapper ojects like <code>AlarmManager</code> and use directly the Session object to make any API calls with any data. The Session object will handle intermittent SIEM errors.
</p>
<pre><code class="python">from msiempy import NitroSession
s = NitroSession()
s.login()
# Get all last 24h alarms details with ESM API v2 (not supported by other objects yet)  
alarms = s.api_request('v2/alarmGetTriggeredAlarms?triggeredTimeRange=LAST_24_HOURS&amp;status=&amp;pageSize=500&amp;pageNumber=1')
for a in alarms:
    a.update(s.api_request('v2/notifyGetTriggeredNotificationDetail', {'id':a['id']}))
</code></pre>
<h3 id="and-more">And more&hellip;</h3>
<p>See the <a href="https://github.com/mfesiem/msiempy/tree/master/samples">samples folder</a> for more detailed uses !<br>
You can also review the <a href="https://github.com/mfesiem/msiempy/tree/master/tests">tests</a>.
</p>
<h2 id="changelog">Changelog</h2>
<p>Please refer to the <a href="https://github.com/mfesiem/msiempy/releases">releases</a> github page.
</p>
<h2 id="contribute">Contribute</h2>
<p>Pull requests are welcome!<br>
Please read the <a href="https://github.com/mfesiem/msiempy/blob/master/CONTRIBUTING.md">contributing</a> file.
</p>
<h2 id="run-tests">Run tests</h2>
<p>Run all tests, sometimes the tests have to be reruns.
</p>
<pre><code>pytest --reruns 3
</code></pre>
<p>You might also want to run per-file tests</p>
<pre><code>pytest tests/auth/test_device.py
</code></pre>
<p>Or per-method test</p>
<pre><code>python3 -m unittest tests.auth.test_event.T.test_add_note
</code></pre>
<h2 id="code-analysis">Code analysis</h2>
<p><a href="https://www.codacy.com/gh/mfesiem/msiempy?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=mfesiem/msiempy&amp;utm_campaign=Badge_Grade"><img alt="Codacy Badge" src="https://app.codacy.com/project/badge/Grade/114821fcf6e14b8eb0f927e0112488c8"></a> <a href="https://codeclimate.com/github/mfesiem/msiempy/maintainability"><img alt="Maintainability" src="https://api.codeclimate.com/v1/badges/0cc21ba8f82394cb05f3/maintainability"></a></p>
<h2 id="error-report">Error report</h2>
<p>Configure log file reporting in the configuration file and and look for <code>"ERROR"</code>.<br>
Useful shell command to get simple list of errors:
</p>
<pre><code>cat /path/to/your/log/file | grep -i error | sort | uniq
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/mfesiem/msiempy/blob/894b7d706affd066bf6282056789fa466b4c3ae1/msiempy/__init__.py#L0-L266" class="git-link">Browse git</a>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;
Welcome to the **msiempy** library documentation.  
The pythonic way to deal with McAfee SIEM API.  
Head out to one of the sub-modules to see objects definitions or scroll down for general documentation.  
Checkout the [msiem CLI](https://github.com/mfesiem/msiem) if you&#39;re looking for a CLI tool.  

***

Links : [GitHub](https://github.com/mfesiem/msiempy), [PyPI](https://pypi.org/project/msiempy/), [Class diagram](https://mfesiem.github.io/docs/msiempy/classes.png), [Packages diagram](https://mfesiem.github.io/docs/msiempy/packages.png), [SIEM API references Home](https://mfesiem.github.io) (generated PDFs and other links)  

***

## Installation 

```
python3 -m pip install msiempy
```

## Authentication and configuration setup  

The module offers a single point of authentication against your SIEM, so you don&#39;t have to worry about authentication when writting your scripts. This means that you need to preconfigure the authentication using the configuration file.

The configuration file is located (by default) securely in your user directory since it contains credentials.  
- For Windows:  `%APPDATA%\.msiem\conf.ini`  
- For Mac :     `$HOME/.msiem/conf.ini`  
- For Linux :   `$XDG_CONFIG_HOME/.msiem/conf.ini` or :   `$HOME/.msiem/conf.ini`  
```
[esm]
host = HOST
user = USER
passwd = PASSWORD&#39;s BASE64

[general]
verbose = no
quiet = no
logfile = /var/log/msiempy/log.txt
timeout = 60
ssl_verify = no
```

To set the password, you can use the [`msiempy_setup.py`](https://github.com/mfesiem/msiempy/blob/master/samples/msiempy_setup.py) script.  
You can also directly paste the password&#39;s base64 in the config file by doing:  
```python
&gt;&gt;&gt; import base64
&gt;&gt;&gt; passwd = &#39;P@assW0rd&#39;
&gt;&gt;&gt; print(base64.b64encode(passwd.encode(&#39;utf-8&#39;)).decode())
UEBhc3NXMHJk
```

## Examples

### Acknowledge alarms

See objects: `msiempy.alarm.AlarmManager` and `msiempy.alarm.Alarm`

Print all `unacknowledged` alarms of the year who&#39;s name *match* `&#39;Test alarm&#39;` and triggering event message match `&#39;Wordpress&#39;`.
Then acknowledge the alarms and make sure they are all acknowledged.  

The number of alarms retreived is defined by the `page_size` property.

```python
from msiempy import AlarmManager, Alarm
# Make an alarm query
alarms=AlarmManager(
        time_range=&#39;CURRENT_YEAR&#39;,
        status_filter=&#39;unacknowledged&#39;, # This filter is computed on the server side
        filters=[(&#39;alarmName&#39;, &#39;Test alarm&#39;)], # Other filters are applied as regex
        event_filters=[(&#39;ruleName&#39;,&#39;Wordpress&#39;)], 
        page_size=5 # Will only load 5 alarms (per query), increase limit to 500 or 1000 for better performance
    ) 
# Load the data into the list
alarms.load_data() 
# Print results
print(&#34;Alarm list: &#34;)
print(alarms)
print(alarms.get_text(
        fields=[&#39;id&#39;,&#39;triggeredDate&#39;,&#39;acknowledgedDate&#39;, &#39;alarmName&#39;, &#39;acknowledgedUsername&#39;]))
# Acknowledge alarms
print(&#34;Acknowledge alarms...&#34;)
for alarm in alarms:
    alarm.acknowledge()
```  

### Execute an event query 

See objects: `msiempy.event.EventManager`, `msiempy.event.FieldFilter`, `msiempy.event.Event`  \

Query events according to destination IP and hostname filters, sorted by AlertID. 
```python
from  msiempy import EventManager, FieldFilter

print(&#39;Simple event query sorted by AlertID&#39;)
events = EventManager(
        time_range=&#39;CURRENT_YEAR&#39;,
        fields=[&#39;SrcIP&#39;, &#39;AlertID&#39;], # SrcIP and AlertID are not queried by default
        filters=[
                FieldFilter(&#39;DstIP&#39;, [&#39;0.0.0.0/0&#39;,]),
                FieldFilter(&#39;HostID&#39;, [&#39;mail&#39;], operator=&#39;CONTAINS&#39;)], # Please replace &#34;mail&#34; by a test hostname
        order=((&#39;ASCENDING&#39;, &#39;AlertID&#39;)),
        limit=10) # Will only load 10 events (per query), increase limit to 500 or 1000 once finish testing for better performance

events.load_data()
print(events)
print(events.get_text(fields=[&#39;AlertID&#39;,&#39;LastTime&#39;,&#39;SrcIP&#39;, &#39;Rule.msg&#39;]))
```

### Add a note to events

Setting the note of an event, retreiving the genuine event from IPSIDAlertID and checking the note is well set. See [`add_wpsan_note.py`](https://github.com/mfesiem/msiempy/blob/master/samples/add_wpsan_note.py) script to see more how to add note to event that triggered alarms !  
```python
from  msiempy import EventManager, Event
events = EventManager(
        time_range=&#39;CURRENT_YEAR&#39;,
        limit=2
)
events.load_data()

for event in events :
        event.set_note(&#34;Test note&#34;)
        genuine_event = Event(id=event[&#39;IPSIDAlertID&#39;]) # Event data will be loaded with ipsGetAlertData
        assert &#34;Test note&#34; in genuine_event[&#39;note&#39;], &#34;The note doesn&#39;t seem to have been added to the event \n {}&#34;.format(event)
```

`msiempy.event.EventManager()` have other arguments: `order`, `start_time` and `end_time` or `time_rage`  

`msiempy.event.EventManager.load_data()` method accept also several parameters. It controls the query&#39;s division time range into slots of `delta` duration, then the query would be divided into the specified number of `slots`. Control also the number of asyncronous jobs using `workers` parameter. `max_query_depth` parameter specify the number of sub-divisions the query can take at most (zero by default). The query is divided only if it hasn&#39;t completed with the current query settings.   
See method documentation for more infos.  
 
See [`dump_all_fields.py`](https://github.com/mfesiem/msiempy/blob/master/samples/dump_all_fields.py) script to have full list of `fields` you can request and fields you can use with `FieldFilter` .

### Execute a grouped event query

Query the curent day events filtered by `IPSID` grouped by `ScrIP`.  

See objects: `msiempy.event.GroupedEventManager` and `msiempy.event.GroupedEvent`.  

```python
from msiempy import GroupedEventManager
import pandas
query = GroupedEventManager(
    time_range=&#39;LAST_3_DAYS&#39;, 
    field=&#39;SrcIP&#39;, 
    filters=[(&#39;IPSID&#39;, &#39;144116287587483648&#39;)]) 
query.load_data()
# Sort the results by total count
results = list(reversed(sorted(query, key=lambda k: int(k[&#39;SUM(Alert.EventCount)&#39;]))))
# Display top 10 in a panda frame
frame=pandas.DataFrame(results[:10])
print(frame.to_string(index=False))
```

Tip: [`all_dev.py` script](https://github.com/mfesiem/msiempy/blob/master/samples/all_dev.py) can help you list all your datasources IDs (for the required `IPSID` filter).  

### Print ESM infos

See object: `msiempy.device.ESM`

Print a few esm infos. ESM object has not state for it self, it&#39;s a simple interface to data structures / values returned by the SIEM.  
```python
&gt;&gt;&gt; from msiempy import ESM
&gt;&gt;&gt; esm=ESM()
&gt;&gt;&gt; esm.version()
&#39;11.2.1&#39;
&gt;&gt;&gt; esm.recs()
[(&#39;ERC-1&#39;, 144116287587483648)]
&gt;&gt;&gt; esm.buildstamp()
&#39;11.2.1 20190725050014&#39;
```

### Dump Datasources

See objects: `msiempy.device.DevTree`, `msiempy.device.DataSource`

Load all datasources and write all infos in a CSV file.  
```python
from msiempy import DevTree

devtree = DevTree()

with open(&#39;all-datasources.csv&#39;, &#39;w&#39;) as f:
        f.write(devtree.get_text(format=&#39;csv&#39;))
```

### Dump Watchlists definitions

See objects: `msiempy.watchlist.WatchlistManager`, `msiempy.watchlist.Watchlist`

Print whatchlist list.
```python
from msiempy import WatchlistManager
watchlists=WatchlistManager()
print(watchlists)
```

### Use the Session object  

See object: `msiempy.core.session.NitroSession`  

You can choose not to use wrapper ojects like `AlarmManager` and use directly the Session object to make any API calls with any data. The Session object will handle intermittent SIEM errors.  

```python
from msiempy import NitroSession
s = NitroSession()
s.login()
# Get all last 24h alarms details with ESM API v2 (not supported by other objects yet)  
alarms = s.api_request(&#39;v2/alarmGetTriggeredAlarms?triggeredTimeRange=LAST_24_HOURS&amp;status=&amp;pageSize=500&amp;pageNumber=1&#39;)
for a in alarms:
    a.update(s.api_request(&#39;v2/notifyGetTriggeredNotificationDetail&#39;, {&#39;id&#39;:a[&#39;id&#39;]}))
```

### And more...

See the [samples folder](https://github.com/mfesiem/msiempy/tree/master/samples) for more detailed uses !  
You can also review the [tests](https://github.com/mfesiem/msiempy/tree/master/tests).   

## Changelog

Please refer to the [releases](https://github.com/mfesiem/msiempy/releases) github page.  

## Contribute

Pull requests are welcome!  
Please read the [contributing](https://github.com/mfesiem/msiempy/blob/master/CONTRIBUTING.md) file.  

## Run tests
Run all tests, sometimes the tests have to be reruns.  
```
pytest --reruns 3
```
You might also want to run per-file tests
```
pytest tests/auth/test_device.py
```
Or per-method test
````
python3 -m unittest tests.auth.test_event.T.test_add_note
````

## Code analysis

[![Codacy Badge](https://app.codacy.com/project/badge/Grade/114821fcf6e14b8eb0f927e0112488c8)](https://www.codacy.com/gh/mfesiem/msiempy?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=mfesiem/msiempy&amp;amp;utm_campaign=Badge_Grade) [![Maintainability](https://api.codeclimate.com/v1/badges/0cc21ba8f82394cb05f3/maintainability)](https://codeclimate.com/github/mfesiem/msiempy/maintainability)

## Error report
Configure log file reporting in the configuration file and and look for `&#34;ERROR&#34;`.  
Useful shell command to get simple list of errors:  
```
cat /path/to/your/log/file | grep -i error | sort | uniq
```

&#34;&#34;&#34;

# List all library objects that the user might need

from .core import NitroConfig, NitroError, NitroSession, FilteredQueryList, NitroList
from .alarm import Alarm, AlarmManager
from .device import ESM, DevTree, DataSource
from .event import (
    Event,
    EventManager,
    GroupFilter,
    FieldFilter,
    GroupedEventManager,
    GroupedEvent,
)
from .watchlist import Watchlist, WatchlistManager
from .__version__ import __version__ as VERSION</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="msiempy.alarm" href="alarm.html">msiempy.alarm</a></code></dt>
<dd>
<div class="desc"><p>Provide alarm management.</p></div>
</dd>
<dt><code class="name"><a title="msiempy.core" href="core/index.html">msiempy.core</a></code></dt>
<dd>
<div class="desc"><p>The core objects of the library â€¦</p></div>
</dd>
<dt><code class="name"><a title="msiempy.device" href="device.html">msiempy.device</a></code></dt>
<dd>
<div class="desc"><p>Provide ESM, Receiver and Datasource management.</p></div>
</dd>
<dt><code class="name"><a title="msiempy.event" href="event.html">msiempy.event</a></code></dt>
<dd>
<div class="desc"><p>Provide event management.</p></div>
</dd>
<dt><code class="name"><a title="msiempy.watchlist" href="watchlist.html">msiempy.watchlist</a></code></dt>
<dd>
<div class="desc"><p>Provide watchlist management.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="McAfee SIEM API Python wrapper" href="https://mfesiem.github.io/docs/msiempy/index.html">
<img src="https://avatars0.githubusercontent.com/u/50667087?s=200&v=4" alt=""> &nbsp; msiempy
</a>
</header>
<form>
<input id="lunr-search" name="q" placeholder="ðŸ”Ž Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = 'search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#authentication-and-configuration-setup">Authentication and configuration setup</a></li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#acknowledge-alarms">Acknowledge alarms</a></li>
<li><a href="#execute-an-event-query">Execute an event query</a></li>
<li><a href="#add-a-note-to-events">Add a note to events</a></li>
<li><a href="#execute-a-grouped-event-query">Execute a grouped event query</a></li>
<li><a href="#print-esm-infos">Print ESM infos</a></li>
<li><a href="#dump-datasources">Dump Datasources</a></li>
<li><a href="#dump-watchlists-definitions">Dump Watchlists definitions</a></li>
<li><a href="#use-the-session-object">Use the Session object</a></li>
<li><a href="#and-more">And more&hellip;</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#contribute">Contribute</a></li>
<li><a href="#run-tests">Run tests</a></li>
<li><a href="#code-analysis">Code analysis</a></li>
<li><a href="#error-report">Error report</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="msiempy.alarm" href="alarm.html">msiempy.alarm</a></code></li>
<li><code><a title="msiempy.core" href="core/index.html">msiempy.core</a></code></li>
<li><code><a title="msiempy.device" href="device.html">msiempy.device</a></code></li>
<li><code><a title="msiempy.event" href="event.html">msiempy.event</a></code></li>
<li><code><a title="msiempy.watchlist" href="watchlist.html">msiempy.watchlist</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<span>This software is licensed under the <a href="https://github.com/mfesiem/msiempy/blob/master/LICENSE">MIT License</a></span>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.1</a>.</p>
</footer>
</body>
</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>msiempy.__init__ : API documentation</title>

    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
  </head>
  <body>

    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="index.html">
            msiempy API Documentation
          </a>
        </div>
      </div>
    </nav>

    <div id="showPrivate">
      <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
    </div>

    <div class="container">

      <div class="page-header">
        <h1 class="module"><code>msiempy.__init__</code> <small>module documentation</small></h1>

        <span id="partOf">
          Part of <code><a href="msiempy.html" class="code" data-type="Package">msiempy</a></code>
          <a href="https://github.com/mfesiem/msiempy/blob/develop//msiempy/__init__.py">View Source</a>
          
        </span>
      </div>

      <div class="extrasDocstring">
        
      </div>

      <div class="moduleDocstring">
        <div><p><strong>The pythonic way to deal with the McAfee SIEM API</strong></p>
<a class="rst-reference external image-reference" href="https://mfesiem.github.io/docs/msiempy/msiempy.html" target="_top"><img alt="Nitro" src="https://avatars0.githubusercontent.com/u/50667087?s=200&amp;v=4" style="width: 50px; height: 50px;" /></a>
<p>Welcome to the <strong>msiempy</strong> library documentation.</p>
<p>Looking for a CLI tool? Checkout the <a class="rst-reference external" href="https://github.com/mfesiem/msiem" target="_top">msiem CLI</a></p>
<p>Already know what you're looking for?
Checkout the <a class="rst-reference external" href="https://mfesiem.github.io/docs/msiempy/moduleIndex.html" target="_top">Module Index</a>.</p>
<dl class="rst-docutils">
<dt>Quick links:</dt>
<dd><ul class="rst-first rst-last rst-simple">
<li><a class="rst-reference external" href="https://github.com/mfesiem/msiempy" target="_top">GitHub | README.md</a></li>
<li><a class="rst-reference external" href="https://mfesiem.github.io/docs/msiempy/classes.png" target="_top">Class diagram</a>, (<a class="rst-reference external" href="https://mfesiem.github.io/docs/msiempy/packages.png" target="_top">Packages diagram</a>)</li>
<li><a class="rst-reference external" href="https://mfesiem.github.io" target="_top">mfesiem.github.io</a> (generated PDFs and other links)</li>
</ul>
</dd>
</dl>
<div class="rst-contents rst-topic" id="rst-table-of-contents">
<p class="rst-topic-title"><strong>Table of Contents</strong></p>
<ul class="rst-simple">
<li><a class="rst-reference internal" href="#rst-installation" id="rst-id1">Installation</a></li>
<li><a class="rst-reference internal" href="#rst-authentication-and-configuration-setup" id="rst-id2">Authentication and configuration setup</a></li>
<li><a class="rst-reference internal" href="#rst-a-few-usage-exemples" id="rst-id3">A few usage exemples</a><ul>
<li><a class="rst-reference internal" href="#rst-execute-an-event-query" id="rst-id4">Execute an event query</a></li>
<li><a class="rst-reference internal" href="#rst-acknowledge-alarms" id="rst-id5">Acknowledge alarms</a></li>
<li><a class="rst-reference internal" href="#rst-make-direct-api-calls" id="rst-id6">Make direct API calls</a></li>
<li><a class="rst-reference internal" href="#rst-add-a-note-to-events" id="rst-id7">Add a note to events</a></li>
<li><a class="rst-reference internal" href="#rst-fetch-esm-infos" id="rst-id8">Fetch ESM infos</a></li>
<li><a class="rst-reference internal" href="#rst-add-a-datasource" id="rst-id9">Add a Datasource</a></li>
<li><a class="rst-reference internal" href="#rst-add-values-to-a-watchlist" id="rst-id10">Add values to a Watchlist</a></li>
<li><a class="rst-reference internal" href="#rst-execute-a-grouped-event-query" id="rst-id11">Execute a grouped event query</a></li>
<li><a class="rst-reference internal" href="#rst-and-more" id="rst-id12">And more...</a></li>
</ul>
</li>
<li><a class="rst-reference internal" href="#rst-changelog" id="rst-id13">Changelog</a></li>
<li><a class="rst-reference internal" href="#rst-contribute" id="rst-id14">Contribute</a></li>
<li><a class="rst-reference internal" href="#rst-code-analysis" id="rst-id15">Code analysis</a></li>
<li><a class="rst-reference internal" href="#rst-error-report" id="rst-id16">Error report</a></li>
</ul>
</div>
<div class="rst-section" id="rst-installation">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id1">Installation</a></h1>
<p>Run:</p>
<pre class="rst-literal-block">
pip install msiempy
</pre>
</div>
<div class="rst-section" id="rst-authentication-and-configuration-setup">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id2">Authentication and configuration setup</a></h1>
<p>The module offers a single point of authentication against your SIEM, so you don't have to worry about authentication when writting your scripts.
This means that you need to preconfigure the authentication using the configuration file.</p>
<p>The configuration file is located (by default) securely in your user directory since it contains credentials.</p>
<ul class="rst-simple">
<li>For Windows:  <tt class="rst-docutils literal"><span class="pre">%APPDATA%\.msiem\conf.ini</span></tt></li>
<li>For Mac :     <tt class="rst-docutils literal"><span class="pre">$HOME/.msiem/conf.ini</span></tt></li>
<li>For Linux :   <tt class="rst-docutils literal"><span class="pre">$XDG_CONFIG_HOME/.msiem/conf.ini</span></tt> or <tt class="rst-docutils literal"><span class="pre">$HOME/.msiem/conf.ini</span></tt></li>
</ul>
<p>Exemple:</p>
<pre class="rst-literal-block">
[esm]
host = HOST
user = USER
passwd = PASSWORD's BASE64
[general]
verbose = no
quiet = no
logfile = /home/user/.msiem/log.txt
timeout = 60
ssl_verify = no
</pre>
<p>To set the password, you can use the <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/blob/master/samples/msiempy_setup.py" target="_top">msiempy_setup.py</a> script.
You can also directly paste the password's base64 in the config file by doing:</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">import</span> base64
<span class="py-prompt">&gt;&gt;&gt; </span>passwd = <span class="py-string">'P@assW0rd'</span>
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(base64.b64encode(passwd.encode(<span class="py-string">'utf-8'</span>)).decode())
<span class="py-output">UEBhc3NXMHJk</span>
</pre></div>
<div class="rst-section" id="rst-a-few-usage-exemples">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id3">A few usage exemples</a></h1>
<div class="rst-section" id="rst-execute-an-event-query">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id4">Execute an event query</a></h2>
<p>Query events according to destination IP and hostname filters, sorted by AlertID.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span>  msiempy <span class="py-keyword">import</span> EventManager, FieldFilter
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(<span class="py-string">'Simple event query sorted by AlertID'</span>)
<span class="py-prompt">&gt;&gt;&gt; </span>events = EventManager(
<span class="py-output">        time_range='CURRENT_YEAR',</span>
<span class="py-output">        fields=['SrcIP', 'AlertID'], # SrcIP and AlertID are not queried by default</span>
<span class="py-output">        filters=[</span>
<span class="py-output">                FieldFilter('DstIP', ['0.0.0.0/0',]),</span>
<span class="py-output">                FieldFilter('HostID', ['mail'], operator='CONTAINS')], # Replace "mail" by a test hostname</span>
<span class="py-output">        order=(('ASCENDING', 'AlertID')),</span>
<span class="py-output">        limit=10) # Will only load 10 events (per query)</span>
<span class="py-prompt">&gt;&gt;&gt; </span>events.load_data()
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(events)
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(events.get_text(fields=[<span class="py-string">'AlertID'</span>,<span class="py-string">'LastTime'</span>,<span class="py-string">'SrcIP'</span>, <span class="py-string">'Rule.msg'</span>]))</pre><dl class="rst-docutils">
<dt>Notes:</dt>
<dd><ul class="rst-first rst-last rst-simple">
<li>The <tt class="rst-docutils literal">limit</tt> argument should be increased to 500 or 1000 once finish testing for better performance.</li>
<li>Dump full list of fields usable in query <a href="msiempy.event.FieldFilter.html"><code>FieldFilter</code></a> with <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/blob/master/samples/dump_all_fields.py" target="_top">dump_all_fields.py</a> script.</li>
</ul>
</dd>
<dt>See:</dt>
<dd>Objects <a href="msiempy.event.EventManager.html"><code>EventManager</code></a> and <a href="msiempy.event.FieldFilter.html"><code>FieldFilter</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-acknowledge-alarms">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id5">Acknowledge alarms</a></h2>
<p>Print all <tt class="rst-docutils literal">unacknowledged</tt> alarms filtered by alarm name and event message, then acknowledge the alarms.</p>
<p>Filter with alarm match <tt class="rst-docutils literal">'Test alarm'</tt> and triggering event message match <tt class="rst-docutils literal">'Wordpress'</tt>.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span> msiempy <span class="py-keyword">import</span> AlarmManager, Alarm
<span class="py-output"># Make an alarm query</span>
<span class="py-prompt">&gt;&gt;&gt; </span>alarms=AlarmManager(
<span class="py-output">        time_range='CURRENT_YEAR',</span>
<span class="py-output">        status_filter='unacknowledged', # passed to alarmGetTriggeredAlarms</span>
<span class="py-output">        filters=[('alarmName', 'Test alarm')], # Regex</span>
<span class="py-output">        event_filters=[('ruleName','Wordpress')], # Regex</span>
<span class="py-output">        page_size=5 # Will only load 5 alarms (per page)</span>
<span class="py-output">)</span>
<span class="py-output"># Load the data into the list</span>
<span class="py-prompt">&gt;&gt;&gt; </span>alarms.load_data()
<span class="py-output"># Print results</span>
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(<span class="py-string">"Alarm list: "</span>)
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(alarms)
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(alarms.get_text(
<span class="py-output">        fields=['id','triggeredDate','acknowledgedDate', 'alarmName', 'acknowledgedUsername']))</span>
<span class="py-output"># Acknowledge alarms</span>
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-builtin">print</span>(<span class="py-string">"Acknowledge alarms"</span>)
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">for</span> alarm <span class="py-keyword">in</span> alarms:
<span class="py-output">        alarm.acknowledge()</span>
</pre><dl class="rst-docutils">
<dt>Notes:</dt>
<dd><ul class="rst-first rst-last rst-simple">
<li>The <tt class="rst-docutils literal">page_size</tt> argument should be increased to 500 or 1000 once finish testing for better performance.</li>
<li>The <a href="msiempy.alarm.AlarmManager.html"><code>AlarmManager</code></a> filtering feature is an addon to what the SIEM API offers, filters are applied locally as regular expressions.</li>
</ul>
</dd>
<dt>See:</dt>
<dd>Objects <a href="msiempy.alarm.AlarmManager.html"><code>AlarmManager</code></a> and <a href="msiempy.alarm.Alarm.html"><code>Alarm</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-make-direct-api-calls">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id6">Make direct API calls</a></h2>
<p>This is useful when dealing with features of the ESM API that are not explicitly implemented in this library yet (i.e. user managment).</p>
<p><strong>Use the session object</strong> to make direct API calls with any data.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span> msiempy <span class="py-keyword">import</span> NitroSession
<span class="py-prompt">&gt;&gt;&gt; </span>s = NitroSession()
<span class="py-prompt">&gt;&gt;&gt; </span>s.login()
<span class="py-output"># Get all last 24h alarms details with ESM API v2 (not supported yet)</span>
<span class="py-prompt">&gt;&gt;&gt; </span>alarms = s.api_request(<span class="py-string">'v2/alarmGetTriggeredAlarms?triggeredTimeRange=LAST_24_HOURS&amp;status=&amp;pageSize=500&amp;pageNumber=1'</span>)
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">for</span> a <span class="py-keyword">in</span> alarms:
<span class="py-output">        a.update(s.api_request('v2/notifyGetTriggeredNotificationDetail', {'id':a['id']}))</span>
</pre><p>The session object will handle authentication and intermittent (but annoying) SIEM errors.</p>
<dl class="rst-docutils">
<dt>See:</dt>
<dd>Object <a href="msiempy.core.session.NitroSession.html"><code>NitroSession</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-add-a-note-to-events">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id7">Add a note to events</a></h2>
<p>Set the note of 2 events and check if the note is well set.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span>  msiempy <span class="py-keyword">import</span> EventManager, Event
<span class="py-prompt">&gt;&gt;&gt; </span>events = EventManager(
<span class="py-output">        time_range='CURRENT_YEAR',</span>
<span class="py-output">        limit=2 )</span>
<span class="py-prompt">&gt;&gt;&gt; </span>events.load_data()
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">for</span> event <span class="py-keyword">in</span> events :
<span class="py-output">        event.set_note("Test note")</span>
<span class="py-output">        event.refresh(use_query=False) # Event data will be loaded with ipsGetAlertData API method</span>
<span class="py-output">        assert "Test note" in genuine_event['note'], "Error, the note hasn't been added"</span>
</pre><dl class="rst-docutils">
<dt>See:</dt>
<dd><ul class="rst-first rst-last rst-simple">
<li><a class="rst-reference external" href="https://github.com/mfesiem/msiempy/blob/master/samples/add_wpsan_note.py" target="_top">add_wpsan_note.py</a> script for more on how to add notes to event that triggered alarms.</li>
<li>Object <a href="msiempy.event.Event.html"><code>Event</code></a></li>
</ul>
</dd>
</dl>
</div>
<div class="rst-section" id="rst-fetch-esm-infos">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id8">Fetch ESM infos</a></h2>
<p>Print a few esm infos. ESM object has not state for it self, it's a simple interface to data structures / values returned by the SIEM.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span> msiempy <span class="py-keyword">import</span> ESM
<span class="py-prompt">&gt;&gt;&gt; </span>esm=ESM()
<span class="py-prompt">&gt;&gt;&gt; </span>esm.version()
<span class="py-output">'11.2.1'</span>
<span class="py-prompt">&gt;&gt;&gt; </span>esm.recs()
<span class="py-output">[('ERC-1', 144116287587483648)]</span>
<span class="py-prompt">&gt;&gt;&gt; </span>esm.buildstamp()
<span class="py-output">'11.2.1 20190725050014'</span>
</pre><dl class="rst-docutils">
<dt>See:</dt>
<dd>Object <a href="msiempy.device.ESM.html"><code>ESM</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-add-a-datasource">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id9">Add a Datasource</a></h2>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span> msiempy <span class="py-keyword">import</span> DevTree
<span class="py-prompt">&gt;&gt;&gt; </span>devtree = DevTree()
<span class="py-prompt">&gt;&gt;&gt; </span>devtree.add({
<span class="py-output">        "name": "Test DS",</span>
<span class="py-output">        "parent_id": "144116287587483648",</span>
<span class="py-output">        "ds_ip": "10.2.2.2",</span>
<span class="py-output">        "hostname": "testds.domain.ca",</span>
<span class="py-output">        "type_id": "65"</span>
<span class="py-output">})</span>
<span class="py-output">{'value': 1385420} # Wait a bit for the request</span>
<span class="py-prompt">&gt;&gt;&gt; </span>devtree.refresh() <span class="py-comment"># Refresh the DevTree</span></pre><dl class="rst-docutils">
<dt>See:</dt>
<dd>Objects <a href="msiempy.device.DevTree.html"><code>DevTree</code></a> and <a href="msiempy.device.DataSource.html"><code>DataSource</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-add-values-to-a-watchlist">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id10">Add values to a Watchlist</a></h2>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span>wl_list = WatchlistManager()
<span class="py-prompt">&gt;&gt;&gt; </span>wl = wl_list.search(<span class="py-string">'test_Watchlist'</span>)[0]
<span class="py-prompt">&gt;&gt;&gt; </span>wl.add_values([<span class="py-string">'1.1.1.2'</span>, <span class="py-string">'2.2.2.1'</span>, <span class="py-string">'3.3.3.1'</span>])</pre><dl class="rst-docutils">
<dt>See:</dt>
<dd>Objects <a href="msiempy.watchlist.WatchlistManager.html"><code>WatchlistManager</code></a>, <a href="msiempy.watchlist.Watchlist.html"><code>Watchlist</code></a></dd>
</dl>
</div>
<div class="rst-section" id="rst-execute-a-grouped-event-query">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id11">Execute a grouped event query</a></h2>
<p>Query the curent day events filtered by <code>IPSID</code> grouped by <code>ScrIP</code>.</p>
<pre class="py-doctest">
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">from</span> msiempy <span class="py-keyword">import</span> GroupedEventManager
<span class="py-prompt">&gt;&gt;&gt; </span><span class="py-keyword">import</span> pprint
<span class="py-prompt">&gt;&gt;&gt; </span>query = GroupedEventManager(
<span class="py-output">                time_range='LAST_3_DAYS',</span>
<span class="py-output">                field='SrcIP',</span>
<span class="py-output">                filters=[('IPSID', '144116287587483648')])</span>
<span class="py-prompt">&gt;&gt;&gt; </span>query.load_data()
<span class="py-output"># Sort the results by total count</span>
<span class="py-prompt">&gt;&gt;&gt; </span>results = <span class="py-builtin">list</span>(<span class="py-builtin">reversed</span>(<span class="py-builtin">sorted</span>(query, key=<span class="py-keyword">lambda</span> k: <span class="py-builtin">int</span>(k[<span class="py-string">'SUM(Alert.EventCount)'</span>]))))
<span class="py-output"># Display top 10</span>
<span class="py-prompt">&gt;&gt;&gt; </span>top10=results[:10]
<span class="py-prompt">&gt;&gt;&gt; </span>pprint.pprint(top10)</pre><dl class="rst-docutils">
<dt>See:</dt>
<dd>Objects <a href="msiempy.event.GroupedEventManager.html"><code>GroupedEventManager</code></a> and <a href="msiempy.event.GroupedEvent.html"><code>GroupedEvent</code></a>.</dd>
<dt>Tip:</dt>
<dd><a class="rst-reference external" href="https://github.com/mfesiem/msiempy/blob/master/samples/all_dev.py" target="_top">all_dev.py script</a> can help you list all your datasources IDs (for the required <tt class="rst-docutils literal">IPSID</tt> filter).</dd>
</dl>
</div>
<div class="rst-section" id="rst-and-more">
<h2 class="heading"><a class="rst-toc-backref" href="#rst-id12">And more...</a></h2>
<dl class="rst-docutils">
<dt>See:</dt>
<dd><ul class="rst-first rst-last rst-simple">
<li>The <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/tree/master/samples" target="_top">samples folder</a></li>
<li>The <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/tree/master/tests" target="_top">tests</a>.</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="rst-section" id="rst-changelog">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id13">Changelog</a></h1>
<p>Please refer to the <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/releases" target="_top">releases</a> github page.</p>
</div>
<div class="rst-section" id="rst-contribute">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id14">Contribute</a></h1>
<dl class="rst-docutils">
<dt>Pull requests are welcome!</dt>
<dd>Please read the <a class="rst-reference external" href="https://github.com/mfesiem/msiempy/blob/master/CONTRIBUTING.md" target="_top">contributing</a> file.</dd>
</dl>
</div>
<div class="rst-section" id="rst-code-analysis">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id15">Code analysis</a></h1>
<a class="rst-reference external image-reference" href="https://www.codacy.com/gh/mfesiem/msiempy?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=mfesiem/msiempy&amp;amp;utm_campaign=Badge_Grade" target="_top"><img alt="Codacy Badge" src="https://app.codacy.com/project/badge/Grade/114821fcf6e14b8eb0f927e0112488c8" /></a>
<a class="rst-reference external image-reference" href="https://codeclimate.com/github/mfesiem/msiempy/maintainability" target="_top"><img alt="Code climate Maintainability" src="https://api.codeclimate.com/v1/badges/0cc21ba8f82394cb05f3/maintainability" /></a>
</div>
<div class="rst-section" id="rst-error-report">
<h1 class="heading"><a class="rst-toc-backref" href="#rst-id16">Error report</a></h1>
<p>Configure log file reporting in the configuration file and and look for <tt class="rst-docutils literal">"ERROR"</tt>.
Useful shell command to get simple list of errors:</p>
<pre class="rst-literal-block">
cat /path/to/your/log/file | grep -i error | sort | uniq
</pre>
</div>
</div>
      </div>

      <div id="splitTables">
        
        

          
      </div>

      <div id="childList">

        

      </div>
      <address>
        <a href="index.html">API Documentation</a> for msiempy, generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a> at 2020-10-12 16:28:09.
      </address>

    </div>

    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>